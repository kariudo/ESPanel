<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESPanel - Sensor Dashboard</title>

    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Materialize CSS -->
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@materializecss/materialize@2.2.2/dist/css/materialize.min.css">
    <style>
        .sensor-value {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online {
            background-color: #4CAF50;
        }

        .status-offline {
            background-color: #f44336;
        }

        .header-icon {
            margin-right: 10px;
        }

        .card-buttons {
            padding-top: 20px;
        }

        .input-row {
            padding-top: 15px;
        }
    </style>
</head>

<body>
    <div class="nav navbar">
        <div class="nav-wrapper blue darken-2">
            <a href="#" class="brand-logo center">
                <i class="material-icons header-icon">dashboard</i>ESPanel
            </a>
        </div>
    </div>

    <div class="container" style="margin-top: 25px;">
        <!-- System Status Card -->
        <div class="row">
            <div class="col s12">
                <div class="card green darken-1 sensor-card">
                    <div class="card-content white-text">
                        <span class="card-title">
                            <i class="material-icons">settings_system_daydream</i> System Status
                        </span>
                        <p>
                            <span class="status-indicator status-online"></span>
                            <span class="sensor-value">System Online</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <div class="section">
            <h4><i class="material-icons">visibility</i> Sensor Status</h4>
            <!-- Temperature Card -->
            <div class="row">
                <div class="col s12 m6">
                    <div class="card blue-grey darken-1 sensor-card">
                        <div class="card-content white-text">
                            <span class="card-title">
                                <i class="material-icons">thermostat</i> Temperature
                            </span>
                            <p>
                                <span class="status-indicator status-online"></span>
                                <span class="sensor-value" id="temperature">Loading...</span>
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Humidity Card -->
                <div class="col s12 m6">
                    <div class="card blue-grey darken-1 sensor-card">
                        <div class="card-content white-text">
                            <span class="card-title">
                                <i class="material-icons">water_drop</i> Humidity
                            </span>
                            <p>
                                <span class="status-indicator status-online"></span>
                                <span class="sensor-value" id="humidity">Loading...</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- WiFi Credentials Form -->
        <div class="section">
            <h4><i class="material-icons">wifi</i> Update WiFi Credentials</h4>
            <div class="row">
                <form id="wifiForm" class="col s12">
                    <div class="card">
                        <div class="class card-content">
                            <div class="row">
                                <div class="input-field s12">
                                    <i class="material-icons prefix">network_wifi</i>
                                    <input type="text" id="ssid" name="ssid" required>
                                    <label for="ssid">Network Name (SSID)</label>
                                </div>
                            </div>
                            <div class="row input-row">
                                <div class="input-field  s12">
                                    <i class="material-icons prefix">lock</i>
                                    <input type="password" id="password" name="password" required>
                                    <label for="password">Password</label>
                                </div>
                            </div>
                            <div class="card-buttons row">
                                <button class="btn waves-effect waves-light blue darken-2 icon-right" type="submit">
                                    Update WiFi Settings
                                    <i class="material-icons">save</i>
                                </button>
                                <button class="btn waves-effect waves-light grey" type="reset">
                                    Clear
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Status Message Area -->
        <div class="section">
            <div id="statusMessage" class="card-panel hide">
                <span id="statusText"></span>
            </div>
        </div>
    </div>

    <!-- Materialize JavaScript -->
    <script>
        function getTheme() {
            const isDarkModeEnabledViaCss = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            const currentTheme = localStorage.getItem('theme');
            const isDark = currentTheme ? currentTheme === 'dark' : isDarkModeEnabledViaCss;
            return isDark;
        }
        function setTheme(enableDark) {
            document.documentElement.setAttribute('theme', enableDark ? 'dark' : 'light');
            localStorage.setItem('theme', enableDark ? 'dark' : 'light');
        }
        const currentState = getTheme();
        setTheme(currentState);
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@materializecss/materialize@2.2.2/dist/js/materialize.min.js"></script>
    <script>
        // Sample data for demonstration - in a real implementation, this would come from your ESP device
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize Materialize components
            if (typeof M !== "undefined") { M.AutoInit() };
            // Simulate updating sensor data (in real implementation, fetch from ESP)
            function updateSensorData() {
                // Get the sensor and climate data.
                fetch("climate.json").then((res) => {
                    res.json().then((climate) => {
                        document.getElementById('temperature').textContent = climate.temp + 'Â°F';
                        document.getElementById('humidity').textContent = climate.humidity + '%';
                    });
                });
            }

            // Update sensor data periodically
            setInterval(updateSensorData, 5000);

            // Handle WiFi form submission
            document.getElementById('wifiForm').addEventListener('submit', function (e) {
                e.preventDefault();

                const ssid = document.getElementById('ssid').value;
                const password = document.getElementById('password').value;

                // Show loading state
                const submitBtn = this.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="material-icons">autorenew</i> Updating...';
                submitBtn.disabled = true;

                // In a real implementation, you would send this data to your ESP device
                fetch('/update_wifi', { method: 'POST', body: JSON.stringify({ ssid, password }) }).then((res) => {
                    // Show success message
                    const statusDiv = document.getElementById('statusMessage');
                    const statusText = document.getElementById('statusText');

                    statusText.innerHTML = '<i class="material-icons">check_circle</i> WiFi credentials updated successfully! Device will reconnect shortly.';
                    statusDiv.className = 'card-panel green lighten-5 green-text';
                    statusDiv.classList.remove('hide');

                    // Reset form
                    document.getElementById('wifiForm').reset();

                    // Restore button
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;

                    // Hide message after 5 seconds
                    setTimeout(() => {
                        statusDiv.classList.add('hide');
                    }, 5000);

                    console.log('WiFi credentials submitted:', { ssid, password });
                });
            });
        });
    </script>
</body>

</html>